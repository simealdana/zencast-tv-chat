(this["webpackJsonpwebinar-zentv"]=this["webpackJsonpwebinar-zentv"]||[]).push([[0],{109:function(e,t){},131:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(17),i=n.n(r),c=(n(80),n(6)),s=n(7),d=n(13),l=n(12),m=n(9),u=n(4),f=n.n(u),p=n(1),h=n(16),b=n(31),v=n(33);var g=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){var n=function(){function e(t){Object(c.a)(this,e),this.streamId=t,this.totalBytesReceivedCount=0,this.totalBytesSent=0,this.packetsLost=0,this.fractionLost=0,this.startTime=0,this.lastBytesReceived=0,this.lastBytesSent=0,this.currentTimestamp=0,this.lastTime=0,this.timerId=0,this.firstByteSentCount=0,this.firstBytesReceivedCount=0,this.audioLevel=-1}return Object(s.a)(e,[{key:"averageOutgoingBitrate",get:function(){return Math.floor(8*(this.totalBytesSentCount-this.firstByteSentCount)/(this.currentTimestamp-this.startTime))}},{key:"averageIncomingBitrate",get:function(){return Math.floor(8*(this.totalBytesReceivedCount-this.firstBytesReceivedCount)/(this.currentTimestamp-this.startTime))}},{key:"currentOutgoingBitrate",get:function(){return Math.floor(8*(this.totalBytesSentCount-this.lastBytesSent)/(this.currentTimestamp-this.lastTime))}},{key:"currentIncomingBitrate",get:function(){return Math.floor(8*(this.totalBytesReceivedCount-this.lastBytesReceived)/(this.currentTimestamp-this.lastTime))}},{key:"currentTime",set:function(e){this.lastTime=this.currentTimestamp,this.currentTimestamp=e,0==this.startTime&&(this.startTime=e-1)}},{key:"totalBytesReceived",set:function(e){this.lastBytesReceived=this.totalBytesReceivedCount,this.totalBytesReceivedCount=e,0==this.firstBytesReceivedCount&&(this.firstBytesReceivedCount=e)}},{key:"totalBytesSent",set:function(e){this.lastBytesSent=this.totalBytesSentCount,this.totalBytesSentCount=e,0==this.firstByteSentCount&&(this.firstByteSentCount=e)}}]),e}(),a=this;for(var o in a.peerconnection_config=null,a.sdp_constraints=null,a.remotePeerConnection=new Array,a.remotePeerConnectionStats=new Array,a.remoteDescriptionSet=new Array,a.iceCandidateList=new Array,a.webSocketAdaptor=null,a.roomName=null,a.videoTrackSender=null,a.audioTrackSender=null,a.playStreamId=new Array,a.micGainNode=null,a.localStream=null,a.bandwidth=900,a.isMultiPeer=!1,a.multiPeerStreamId=null,a.isPlayMode=!1,a.debug=!1,a.publishMode="camera",a.candidateTypes=["udp","tcp"],a.desktopStream=null,a.camera_location="top",a.camera_margin=15,a.camera_percent=15,e)e.hasOwnProperty(o)&&(this[o]=e[o]);if(a.localVideo=document.getElementById(a.localVideoId),a.remoteVideo=document.getElementById(a.remoteVideoId),"camera"==a.mediaConstraints.video?a.publishMode="camera":"screen"==a.mediaConstraints.video?a.publishMode="screen":"screen+camera"==a.mediaConstraints.video&&(a.publishMode="screen+camera"),!("WebSocket"in window))return console.log("WebSocket not supported."),void a.callbackError("WebSocketNotSupported");if("undefined"==typeof navigator.mediaDevices&&0==a.isPlayMode)return console.log("Cannot open camera and mic because of unsecure context. Please Install SSL(https)"),void a.callbackError("UnsecureContext");if(this.setDesktopwithCameraSource=function(e,t,n,o){a.desktopStream=e,navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((function(o){var r=document.createElement("canvas"),i=r.getContext("2d"),c=document.createElement("video");c.srcObject=e,c.play();var s=document.createElement("video");s.srcObject=o,s.play();var d=r.captureStream(15);d.addTrack(n.getAudioTracks()[0]),null==a.localStream?(e.addTrack(n.getAudioTracks()[0]),a.gotStream(d)):a.updateVideoTrack(d,t,a.mediaConstraints,onended,null),setInterval((function(){r.width=c.videoWidth,r.height=c.videoHeight,i.drawImage(c,0,0,r.width,r.height);var e,t=c.videoWidth*(a.camera_percent/100),n=s.videoHeight/s.videoWidth*t,o=r.width-t-a.camera_margin;e="top"==a.camera_location?a.camera_margin:r.height-n-a.camera_margin,i.drawImage(s,o,e,t,n)}),66)})).catch((function(e){a.callbackError(e.name,e.message)}))},this.prepareStreamTracks=function(e,t,n,o){var r=n.getAudioTracks();if(r.length>0&&n.removeTrack(r[0]),"undefined"!=t&&0!=t){var i={audio:t};navigator.mediaDevices.getUserMedia(i).then((function(t){var r=function(t){a.callback("screen_share_stopped"),a.setVideoCameraSource(o,e,null,!0)};"screen"==a.publishMode?a.updateVideoTrack(n,o,e,r,!0):"screen+camera"==a.publishMode?a.setDesktopwithCameraSource(n,o,t,r):(n.addTrack(t.getAudioTracks()[0]),a.gotStream(n))})).catch((function(e){a.callbackError(e.name,e.message)}))}},this.getUserMedia=function(e,t,n){"screen+camera"==a.publishMode||"screen"==a.publishMode?navigator.mediaDevices.getDisplayMedia(e).then((function(o){a.prepareStreamTracks(e,t,o,n)})).catch((function(e){if("NotAllowedError"===e.name)if(console.debug("Permission denied error"),a.callbackError("ScreenSharePermissionDenied"),null==a.localStream){a.openStream({video:!0,audio:!0})}else a.switchVideoCameraCapture(n);else a.callbackError(e.name,e.message)})):navigator.mediaDevices.getUserMedia(e).then((function(o){a.prepareStreamTracks(e,t,o,n)})).catch((function(e){a.callbackError(e.name,e.message)}))},this.openStream=function(e){a.mediaConstraints=e;var t=!1;"undefined"!=typeof e.audio&&0!=e.audio&&(t=e.audio),"undefined"!=typeof e.video?a.getUserMedia(e,t):(console.error("MediaConstraint video is not defined"),a.callbackError("media_constraint_video_not_defined"))},this.closeStream=function(){a.localStream.getVideoTracks().forEach((function(e){e.onended=null,e.stop()})),a.localStream.getAudioTracks().forEach((function(e){e.onended=null,e.stop()}))},this.checkBrowserScreenShareSupported=function(){("undefined"!=typeof navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia||navigator.getDisplayMedia)&&a.callback("browser_screen_share_supported")},a.checkBrowserScreenShareSupported(),this.isPlayMode||"undefined"==typeof a.mediaConstraints||null!=this.localStream)null!=a.webSocketAdaptor&&0!=a.webSocketAdaptor.isConnected()||(a.webSocketAdaptor=new i);else if("undefined"!=typeof a.mediaConstraints.video&&0!=a.mediaConstraints.video)a.mediaConstraints.audio.mandatory?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){navigator.mediaDevices.getUserMedia(a.mediaConstraints).then((function(t){var n=new AudioContext,o=n.createGain();o.gain.value=1;var r=n.createMediaStreamDestination();n.createMediaStreamSource(t).connect(o),a.micGainNode=n.createGain(),a.micGainNode.gain.value=1,n.createMediaStreamSource(e).connect(a.micGainNode),o.connect(r),a.micGainNode.connect(r),t.removeTrack(t.getAudioTracks()[0]),r.stream.getAudioTracks().forEach((function(e){t.addTrack(e)})),console.debug("Running gotStream"),a.gotStream(t)})).catch((function(e){a.callbackError(e.name,e.message)}))})).catch((function(e){a.callbackError(e.name,e.message)})):a.openStream(a.mediaConstraints,a.mode);else{var r={audio:a.mediaConstraints.audio};navigator.mediaDevices.getUserMedia(r).then((function(e){a.gotStream(e)})).catch((function(e){a.callbackError(e.name,e.message)}))}function i(){var e=new WebSocket(a.websocket_url),t=!1,n=-1,o=function(){-1!=n&&(a.debug,clearInterval(n),n=-1)};this.close=function(){e.close()},e.onopen=function(){a.debug,n=setInterval((function(){e.send(JSON.stringify({command:"ping"}))}),3e3),t=!0,a.callback("initialized")},this.send=function(t){0!=e.readyState&&2!=e.readyState&&3!=e.readyState?e.send(t):a.callbackError("WebSocketNotConnected")},this.isConnected=function(){return t},e.onmessage=function(e){var t=JSON.parse(e.data);"start"==t.command?(a.debug,a.startPublishing(t.streamId)):"takeCandidate"==t.command?(a.debug&&(console.debug("received ice candidate for stream id "+t.streamId),console.debug(t.candidate)),a.takeCandidate(t.streamId,t.label,t.candidate)):"takeConfiguration"==t.command?(a.debug&&console.log("received remote description type for stream id: "+t.streamId+" type: "+t.type),a.takeConfiguration(t.streamId,t.sdp,t.type)):"stop"==t.command?(console.debug("Stop command received"),a.closePeerConnection(t.streamId)):"error"==t.command?a.callbackError(t.definition):"notification"==t.command?(a.callback(t.definition,t),"play_finished"!=t.definition&&"publish_finished"!=t.definition||a.closePeerConnection(t.streamId)):"streamInformation"==t.command?a.callback(t.command,t):"pong"==t.command?a.callback(t.command):"trackList"==t.command?a.callback(t.command,t):"connectWithNewId"==t.command?(a.multiPeerStreamId=t.streamId,a.join(t.streamId)):"peerMessageCommand"==t.command&&a.callback(t.command,t)},e.onerror=function(e){o(),a.callbackError(e)},e.onclose=function(e){t=!1,o(),a.callback("closed",e)}}this.enableMicInMixedAudio=function(e){null!=a.micGainNode&&(a.micGainNode.gain.value=e?1:0)},this.publish=function(e,t){var n={command:"publish",streamId:e,token:t,video:a.localStream.getVideoTracks().length>0,audio:a.localStream.getAudioTracks().length>0};a.webSocketAdaptor.send(JSON.stringify(n))},this.joinRoom=function(e,t){a.roomName=e;var n={command:"joinRoom",room:e,streamId:t};a.webSocketAdaptor.send(JSON.stringify(n))},this.play=function(e,t,n,o){a.playStreamId.push(e);var r={command:"play",streamId:e,token:t,room:n,trackList:o};a.webSocketAdaptor.send(JSON.stringify(r))},this.stop=function(e){a.closePeerConnection(e);var t={command:"stop",streamId:e};a.webSocketAdaptor.send(JSON.stringify(t))},this.join=function(e){var t={command:"join",streamId:e,multiPeer:a.isMultiPeer&&null==a.multiPeerStreamId,mode:a.isPlayMode?"play":"both"};a.webSocketAdaptor.send(JSON.stringify(t))},this.leaveFromRoom=function(e){a.roomName=e;var t={command:"leaveFromRoom",room:e};console.log("leave request is sent for "+e),a.webSocketAdaptor.send(JSON.stringify(t))},this.leave=function(e){var t={command:"leave",streamId:a.isMultiPeer&&null!=a.multiPeerStreamId?a.multiPeerStreamId:e};a.webSocketAdaptor.send(JSON.stringify(t)),a.closePeerConnection(e),a.multiPeerStreamId=null},this.getStreamInfo=function(e){var t={command:"getStreamInfo",streamId:e};this.webSocketAdaptor.send(JSON.stringify(t))},this.enableTrack=function(e,t,n){var a={command:"enableTrack",streamId:e,trackId:t,enabled:n};this.webSocketAdaptor.send(JSON.stringify(a))},this.getTracks=function(e,t){a.playStreamId.push(e);var n={command:"getTrackList",streamId:e,token:t};a.webSocketAdaptor.send(JSON.stringify(n))},this.gotStream=function(e){a.localStream=e,a.localVideo.srcObject=e,null!=a.webSocketAdaptor&&0!=a.webSocketAdaptor.isConnected()||(a.webSocketAdaptor=new i),navigator.mediaDevices.enumerateDevices().then((function(e){var t=new Array;e.forEach((function(e){"audioinput"!=e.kind&&"videoinput"!=e.kind||t.push(e)})),a.callback("available_devices",t)})).catch((function(e){console.error("Cannot get devices -> error name: "+e.name+": "+e.message)}))},this.switchVideoCameraCapture=function(e,t){var n=a.localStream.getVideoTracks()[0];n?n.stop():console.warn("There is no video track in local stream"),a.publishMode="camera","undefined"!=typeof t&&(a.mediaConstraints.video={deviceId:t}),a.setVideoCameraSource(e,a.mediaConstraints,null,!0,t)},this.switchDesktopCapture=function(e){a.publishMode="screen";a.getUserMedia(a.mediaConstraints,!1,e)},this.switchDesktopCaptureWithCamera=function(e){a.publishMode="screen+camera"},a.updateLocalStream=function(e,t,n){n&&null!=a.desktopStream&&a.desktopStream.getVideoTracks()[0].stop();var o=a.localStream.getVideoTracks()[0];a.localStream.removeTrack(o),o.stop(),a.localStream.addTrack(e.getVideoTracks()[0]),a.localVideo.srcObject=a.localStream,null!=t&&(e.getVideoTracks()[0].onended=function(e){t(e)})},this.setVideoCameraSource=function(e,t,n,o){navigator.mediaDevices.getUserMedia(t).then((function(r){a.updateVideoTrack(r,e,t,n,o)})).catch((function(e){a.callbackError(e.name)}))},this.updateVideoTrack=function(e,t,n,o,r){if(null!=a.remotePeerConnection[t]){var i=a.remotePeerConnection[t].getSenders().find((function(e){return"video"==e.track.kind}));i?i.replaceTrack(e.getVideoTracks()[0]).then((function(t){a.updateLocalStream(e,o,r)})).catch((function(e){console.log(e.name)})):console.error("VideoTrackSender is undefined or null")}else a.updateLocalStream(e,o,r)},this.onTrack=function(e,t){if(console.log("onTrack"),null!=a.remoteVideo)a.remoteVideo.srcObject!==e.streams[0]&&(a.remoteVideo.srcObject=e.streams[0],console.log("Received remote stream"));else{var n={stream:e.streams[0],track:e.track,streamId:t};a.callback("newStreamAvailable",n)}},this.iceCandidateReceived=function(e,t){if(e.candidate){var n=!1;if(""==e.candidate.candidate?n=!0:"undefined"==typeof e.candidate.protocol?a.candidateTypes.forEach((function(t){e.candidate.candidate.toLowerCase().includes(t)&&(n=!0)})):n=a.candidateTypes.includes(e.candidate.protocol.toLowerCase()),n){var o={command:"takeCandidate",streamId:t,label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate};a.debug&&(console.log("sending ice candiate for stream Id "+t),console.log(JSON.stringify(e.candidate))),a.webSocketAdaptor.send(JSON.stringify(o))}else console.log("Candidate's protocol(full sdp: "+e.candidate.candidate+") is not supported. Supported protocols: "+a.candidateTypes),""!=e.candidate.candidate&&a.callbackError("protocol_not_supported","Support protocols: "+a.candidateTypes.toString()+" candidate: "+e.candidate.candidate)}else console.log("No event.candidate in the iceCandidate event")},this.initDataChannel=function(e,t){t.onerror=function(n){console.log("Data Channel Error:",n);var o={streamId:e,error:n};console.log("channel status: ",t.readyState),"closed"!=t.readyState&&a.callbackError("data_channel_error",o)},t.onmessage=function(t){var n={streamId:e,event:t};a.callback("data_received",n)},t.onopen=function(){a.remotePeerConnection[e].dataChannel=t,console.log("Data channel is opened"),a.callback("data_channel_opened",e)},t.onclose=function(){console.log("Data channel is closed"),a.callback("data_channel_closed",e)}},this.initPeerConnection=function(e,t){if(null==a.remotePeerConnection[e]){var n=e;if(console.log("stream id in init peer connection: "+e+" close stream id: "+n),a.remotePeerConnection[e]=new RTCPeerConnection(a.peerconnection_config),a.remoteDescriptionSet[e]=!1,a.iceCandidateList[e]=new Array,a.playStreamId.includes(e)||null!=a.localStream&&a.remotePeerConnection[e].addStream(a.localStream),a.remotePeerConnection[e].onicecandidate=function(e){a.iceCandidateReceived(e,n)},a.remotePeerConnection[e].ontrack=function(e){a.onTrack(e,n)},"publish"==t){if(a.remotePeerConnection[e].createDataChannel){var o=a.remotePeerConnection[e].createDataChannel(e,{ordered:!0});a.initDataChannel(e,o)}else console.warn("CreateDataChannel is not supported")}else if("play"==t)a.remotePeerConnection[e].ondatachannel=function(t){a.initDataChannel(e,t.channel)};else{if(a.remotePeerConnection[e].createDataChannel){var r=a.remotePeerConnection[e].createDataChannel(e,{ordered:!0});a.initDataChannel(e,r),a.remotePeerConnection[e].ondatachannel=function(t){a.initDataChannel(e,t.channel)}}else console.warn("CreateDataChannel is not supported")}a.remotePeerConnection[e].oniceconnectionstatechange=function(t){var n={state:a.remotePeerConnection[e].iceConnectionState,streamId:e};a.callback("ice_connection_state_changed",n),a.isPlayMode||"connected"==a.remotePeerConnection[e].iceConnectionState&&a.changeBandwidth(a.bandwidth,e).then((function(){console.log("Bandwidth is changed to "+a.bandwidth)})).catch((function(e){return console.error(e)}))}}},this.closePeerConnection=function(e){if(null!=a.remotePeerConnection[e]&&(null!=a.remotePeerConnection[e].dataChannel&&a.remotePeerConnection[e].dataChannel.close(),"closed"!=a.remotePeerConnection[e].signalingState)){a.remotePeerConnection[e].close(),a.remotePeerConnection[e]=null,delete a.remotePeerConnection[e];var t=a.playStreamId.indexOf(e);-1!=t&&a.playStreamId.splice(t,1)}null!=a.remotePeerConnectionStats[e]&&(clearInterval(a.remotePeerConnectionStats[e].timerId),delete a.remotePeerConnectionStats[e])},this.signallingState=function(e){return null!=a.remotePeerConnection[e]?a.remotePeerConnection[e].signalingState:null},this.iceConnectionState=function(e){return null!=a.remotePeerConnection[e]?a.remotePeerConnection[e].iceConnectionState:null},this.gotDescription=function(e,t){a.remotePeerConnection[t].setLocalDescription(e).then((function(n){console.debug("Set local description successfully for stream Id "+t);var o={command:"takeConfiguration",streamId:t,type:e.type,sdp:e.sdp};a.debug&&(console.debug("local sdp: "),console.debug(e.sdp)),a.webSocketAdaptor.send(JSON.stringify(o))})).catch((function(e){console.error("Cannot set local description. Error is: "+e)}))},this.turnOffLocalCamera=function(){null!=a.remotePeerConnection?a.localStream.getVideoTracks()[0].enabled=!1:this.callbackError("NoActiveConnection")},this.turnOnLocalCamera=function(){null!=a.remotePeerConnection?a.localStream.getVideoTracks()[0].enabled=!0:this.callbackError("NoActiveConnection")},this.muteLocalMic=function(){null!=a.remotePeerConnection?a.localStream.getAudioTracks()[0].enabled=!1:this.callbackError("NoActiveConnection")},this.unmuteLocalMic=function(){null!=a.remotePeerConnection?a.localStream.getAudioTracks()[0].enabled=!0:this.callbackError("NoActiveConnection")},this.takeConfiguration=function(e,t,n){var o=e,r=n,i=t,c="offer"==r,s="publish";c&&(s="play"),a.initPeerConnection(o,s),a.remotePeerConnection[o].setRemoteDescription(new RTCSessionDescription({sdp:i,type:r})).then((function(e){a.debug&&(console.debug("set remote description is succesfull with response: "+e+" for stream : "+o+" and type: "+r),console.debug(i)),a.remoteDescriptionSet[o]=!0;var t=a.iceCandidateList[o].length;console.debug("Ice candidate list size to be added: "+t);for(var n=0;n<t;n++)a.addIceCandidate(o,a.iceCandidateList[o][n]);a.iceCandidateList[o]=[],c&&(console.log("try to create answer for stream id: "+o),a.remotePeerConnection[o].createAnswer(a.sdp_constraints).then((function(e){console.log("created answer for stream id: "+o),a.gotDescription(e,o)})).catch((function(e){console.error("create answer error :"+e)})))})).catch((function(e){a.debug&&console.error("set remote description is failed with error: "+e),(e.toString().indexOf("InvalidAccessError")>-1||e.toString().indexOf("setRemoteDescription")>-1)&&a.callbackError("notSetRemoteDescription")}))},this.takeCandidate=function(e,t,n){var o=e,r=new RTCIceCandidate({sdpMLineIndex:t,candidate:n});a.initPeerConnection(o,"peer"),1==a.remoteDescriptionSet[o]?a.addIceCandidate(o,r):(console.debug("Ice candidate is added to list because remote description is not set yet"),a.iceCandidateList[o].push(r))},this.addIceCandidate=function(e,t){var n=!1;""==t.candidate?n=!0:"undefined"==typeof t.protocol?a.candidateTypes.forEach((function(e){t.candidate.toLowerCase().includes(e)&&(n=!0)})):n=a.candidateTypes.includes(t.protocol.toLowerCase()),n?a.remotePeerConnection[e].addIceCandidate(t).then((function(t){a.debug&&console.log("Candidate is added for stream "+e)})).catch((function(n){console.error("ice candiate cannot be added for stream id: "+e+" error is: "+n),console.error(t)})):a.debug&&console.log("Candidate's protocol("+t.protocol+") is not supported.Candidate: "+t.candidate+" Supported protocols:"+a.candidateTypes)},this.startPublishing=function(e){var t=e;a.initPeerConnection(t,"publish"),a.remotePeerConnection[t].createOffer(a.sdp_constraints).then((function(e){a.gotDescription(e,t)})).catch((function(e){console.error("create offer error for stream id: "+t+" error: "+e)}))},this.getVideoSender=function(e){var t=null;if(("chrome"===v.a.browserDetails.browser||"firefox"===v.a.browserDetails.browser&&v.a.browserDetails.version>=64)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype)for(var n=a.remotePeerConnection[e].getSenders(),o=0;o<n.length;o++)if(null!=n[o].track&&"video"==n[o].track.kind){t=n[o];break}return t},this.changeBandwidth=function(e,t){var n="",o=a.getVideoSender(t);if(null!=o){var r=o.getParameters();return r.encodings||(r.encodings=[{}]),"unlimited"===e?delete r.encodings[0].maxBitrate:r.encodings[0].maxBitrate=1e3*e,o.setParameters(r)}return n="Video sender not found to change bandwidth",Promise.reject(n)},this.getStats=function(e){a.remotePeerConnection[e].getStats(null).then((function(t){var n=0,o=0,r=0,i=0,c=0,s=-1;t.forEach((function(e){"inbound-rtp"==e.type?(n+=e.bytesReceived,o+=e.packetsLost,r+=e.fractionLost,i=e.timestamp):"outbound-rtp"==e.type?(c+=e.bytesSent,i=e.timestamp):"track"==e.type&&"undefined"!=typeof e.kind&&"audio"==e.kind&&"undefined"!=typeof e.audioLevel&&(s=e.audioLevel)})),a.remotePeerConnectionStats[e].totalBytesReceived=n,a.remotePeerConnectionStats[e].packetsLost=o,a.remotePeerConnectionStats[e].fractionLost=r,a.remotePeerConnectionStats[e].currentTime=i,a.remotePeerConnectionStats[e].totalBytesSent=c,a.remotePeerConnectionStats[e].audioLevel=s,a.callback("updated_stats",a.remotePeerConnectionStats[e])}))},this.enableStats=function(e){a.remotePeerConnectionStats[e]=new n(e),a.remotePeerConnectionStats[e].timerId=setInterval((function(){a.getStats(e)}),5e3)},this.closeWebSocket=function(){for(var e in a.remotePeerConnection)a.remotePeerConnection[e].close();a.remotePeerConnection=new Array,a.webSocketAdaptor.close()},this.peerMessage=function(e,t,n){var o={command:"peerMessageCommand",streamId:e,definition:t,data:n};a.webSocketAdaptor.send(JSON.stringify(o))},this.sendData=function(e,t){a.remotePeerConnection[e].dataChannel.send(t)}}},C=n(73),S=n.n(C),k=n(15),w=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).videoRef=null,a.videoRef=o.a.createRef(),a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.updateVideoStream()}},{key:"componentDidUpdate",value:function(){this.updateVideoStream()}},{key:"updateVideoStream",value:function(){this.videoRef.current.srcObject!==this.props.stream&&(this.videoRef.current.srcObject=this.props.stream)}},{key:"render",value:function(){var e=this.props.stream;return o.a.createElement("div",{className:"videoContainer"},e?o.a.createElement("video",{ref:this.videoRef,autoPlay:!0}):o.a.createElement("div",null))}}]),n}(o.a.Component),y=n(32),O=n.n(y),I=function(){return o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24"},o.a.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),o.a.createElement("path",{fill:"greenyellow",d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.11-.9-2-2-2H4c-1.11 0-2 .89-2 2v10c0 1.1.89 2 2 2H0v2h24v-2h-4zm-7-3.53v-2.19c-2.78 0-4.61.85-6 2.72.56-2.67 2.11-5.33 6-5.87V7l4 3.73-4 3.74z"}))},j=function(){return o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24"},o.a.createElement("path",{fill:"greenyellow",d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"}),o.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}))},E=function(){return o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24"},o.a.createElement("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),o.a.createElement("path",{fill:"greenyellow",d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"}))},R=function(){return o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24"},o.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),o.a.createElement("path",{fill:"greenyellow",d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"}))},T=function(){return o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24"},o.a.createElement("path",{d:"M0 0h24v24H0zm0 0h24v24H0z",fill:"none"}),o.a.createElement("path",{fill:"greenyellow",d:"M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"}))},M=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={isMicMute:!1,ifCamaraOff:!1},a}return Object(s.a)(n,[{key:"render",value:function(){var e=this.props.webinarReducer;return o.a.createElement("div",{className:" w100"},o.a.createElement(O.a,{className:"layout",cols:3,width:1200,layout:[{i:"a",x:0,y:0,w:2,h:2,static:!0},{i:"b",x:2,y:0,w:2,h:2,minW:2,maxW:4},{i:"c",x:4,y:0,w:1,h:2}],rowHeight:300},this.props.webinarReducer.roomOfStream.map((function(e,t){return o.a.createElement("div",{key:"".concat(t),style:{zIndex:1e3}},o.a.createElement(w,{stream:e.stream}))}))),o.a.createElement("div",{className:"w100",style:{zIndex:1001,position:"absolute",bottom:0}},o.a.createElement("button",{className:"control-btn"},o.a.createElement(I,null)),o.a.createElement("button",{className:"control-btn",onClick:this.props.microMute},(e.isMicMute,o.a.createElement(j,null))),o.a.createElement("button",{className:"control-btn",onClick:this.props.camaraOff},(e.ifCamaraOff,o.a.createElement(T,null)))),e.showVideo&&o.a.createElement("div",{className:"status"},o.a.createElement("p",null,"Establishing connection...")))}}]),n}(o.a.Component),P=Object(k.b)((function(e){return{webinarReducer:e.webinarReducer}}),(function(e){return{setAdmin:function(t){e({type:"set_admin",payload:t})},setCamara:function(t){e({type:" camara_off",payload:t})},setMicro:function(t){e({type:"micro_mute",payload:t})}}}))(M),A=(n(128),n(129),function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).generateDOM=function(){return a.props.webinarReducer.roomOfStream.map((function(e,t){return o.a.createElement("div",{key:"".concat(t),style:{zIndex:1e3}},o.a.createElement(w,{stream:e.stream}))}))},a.emitCamaraOff=function(e,t){a.props.webinarReducer.socket.emit("turnOffCamara",{streamId:e,turnOffCamara:t})},a.emitMuteOff=function(e,t){a.props.webinarReducer.socket.emit("muteMicro",{streamId:e,muteMicro:t})},a.state={col:{lg:12,md:10,sm:6,xs:4,xxs:2}},a}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props.webinarReducer,n=[{i:"0",x:0,y:0,w:2,h:2,maxW:1/0,isResizable:!0,isDraggable:!0},{i:"1",x:5,y:0,w:2,h:2,maxW:1/0},{i:"2",x:10,y:10,w:1,h:2,maxW:1/0}];return o.a.createElement("div",{className:" w100"},o.a.createElement(O.a,{className:"layout",cols:3,width:1200,layout:n,rowHeight:300},this.props.webinarReducer.roomOfStream.map((function(n,a){return o.a.createElement("div",{key:"".concat(a),style:{zIndex:1e3}},o.a.createElement(w,{stream:n.stream}),o.a.createElement("div",{className:"w100",style:{zIndex:1001,position:"absolute",bottom:0}},o.a.createElement("button",{className:"control-btn"},o.a.createElement(I,null)),o.a.createElement("button",{className:"control-btn",onClick:function(){e.emitMuteOff(n.streamId,!0)}},t.isMicMute?o.a.createElement(E,null):o.a.createElement(j,null)),o.a.createElement("button",{className:"control-btn",onClick:function(){e.emitCamaraOff(n.streamId,!0)}},t.ifCamaraOff?o.a.createElement(T,null):o.a.createElement(R,null))))}))),t.showVideo&&o.a.createElement("div",{className:"status"},o.a.createElement("p",null,"Establishing connection...")))}}]),n}(o.a.Component)),N=Object(k.b)((function(e){return{webinarReducer:e.webinarReducer}}))(A),_=n(3),x=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).createRoom=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}return e.next=3,fetch("https://videoconference.ulive.io:5443/LiveApp/rest/v2/broadcasts/create",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",cache:"default"}).then((function(e){return e.json()})).then((function(e){a.setState(Object(p.a)(Object(p.a)({},a.state),{},{streamId:e.streamId}))}));case 3:return e.next=5,a.webRTCInit();case 5:e.next=8;break;case 7:a.setRedirect();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.webRTCInit=Object(h.a)(f.a.mark((function e(){var t,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(b.a)(a),n=a.state.websocketURL,o=new g({websocket_url:n,mediaConstraints:{video:!0,audio:!0},peerconnection_config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},sdp_constraints:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},localVideoId:"localVideo",debug:!0,callback:function(e,n){if("pong"!==e)if("initialized"==e)t.joinRoom();else if("joinedTheRoom"==e)t.state.playOnly?console.log("playOnly"):t.state.webRTCAdaptor.publish(n.streamId),null!=n.streams&&(console.log(n.streams),n.streams.forEach((function(e){t.state.webRTCAdaptor.play(e,t.state.token,t.state.roomNameBox)})));else if("streamJoined"==e){var a=t.state,o=(a.playOnly,a.token),r=a.roomNameBox;t.state.webRTCAdaptor.play(n.streamId,o,r)}else if("newStreamAvailable"==e)t.playVideo(n);else if("streamLeaved"==e)t.removeRemoteVideo(n.streamId);else if("publish_started"==e)t.props.setAdmin(!0),t.setState(Object(p.a)(Object(p.a)({},t.state),{},{isAdmin:!0})),t.setAdmin(n);else if("publish_finished"==e);else if("leavedFromRoom"==e);else if("closed"==e)"undefined"!=typeof n&&console.log("Connecton closed: "+JSON.stringify(n));else if("play_finished"==e){var i=document.getElementById("remoteVideo"+n.streamId);null!=i&&(i.srcObject=null)}else"streamInformation"==e?t.state.webRTCAdaptor.streamInformation(n):"data_channel_opened"==e?t.setState(Object(p.a)(Object(p.a)({},t.state),{},{isDataChanelOpen:!0})):"data_channel_closed"==e?t.setState(Object(p.a)(Object(p.a)({},t.state),{},{isDataChanelOpen:!1})):"data_received"==e&&t.state.webRTCAdaptor.handleNotificationEvent(n)},callbackError:function(e,t){}},!0),a.setState(Object(p.a)(Object(p.a)({},a.state),{},{webRTCAdaptor:o}));case 7:case"end":return e.stop()}}),e)}))),a.setAdmin=function(e){},a.joinRoom=Object(h.a)(f.a.mark((function e(){var t,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state,n=t.roomNameBox,o=t.streamId,e.next=3,a.initSocket();case 3:return e.next=5,a.state.webRTCAdaptor.joinRoom(n,o);case 5:case"end":return e.stop()}}),e)}))),a.leaveRoom=function(e){var t=a.props.setRoomOfStream,n=a.state,o=(n.webRTCAdaptor,n.roomNameBox),r=n.roomOfStream;a.state.webRTCAdaptor.leaveFromRoom(o),a.state.webRTCAdaptor.muteLocalMic(!1),a.state.webRTCAdaptor.turnOffLocalCamera(!1);var i=r.filter((function(t){return t.streamId!==e.streamId}));t(r),a.setState(Object(p.a)(Object(p.a)({},a.state),{},{roomOfStream:i,showVideo:!1}))},a.playVideo=function(e){var t=a.props.setRoomOfStream,n=a.state.socketId;if(e.streamId){var r={streamId:e.streamId,stream:e.stream,videoRef:o.a.createRef(),ifCamaraOff:!0,microMute:!0,socketId:n},i=a.state.roomOfStream;if(i.length>0)i.some((function(e){return e.streamId===r.streamId}))||i.push(r);else i.push(r);t(i),a.setState(Object(p.a)(Object(p.a)({},a.state),{},{roomOfStream:i,showVideo:!0}))}},a.removeRemoteVideo=function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://videoconference.ulive.io:5443/LiveApp/rest/v2/broadcasts/"+t,{method:"DELETE",headers:{"Content-Type":"application/json"},mode:"cors",cache:"default"}).then((function(e){return e.json()}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleChange=function(e){var t=e.target,n=t.id,o=t.value;a.setState(Object(p.a)(Object(p.a)({},a.state),{},Object(m.a)({},"".concat(n),o)))},a.initSocket=function(){var e=a.state,t=e.streamId,n=e.roomNameBox,o=e.userName,r=a.props.setSocket,i=S()("http://localhost:5000");r(i),a.setState(Object(p.a)(Object(p.a)({},a.state),{},{socket:i}),(function(){i.on("connect",(function(e){i.emit("entrarChat",{streamId:t,roomNameBox:n,userName:o})}))})),i.on("entrarChat",(function(e){a.setState(Object(p.a)(Object(p.a)({},a.state),{},{socketId:e.socketId}))})),i.on("turnOffCamara",(function(e){e.turnOffLocalCamera&&a.turnOffLocalCamera(!0)})),i.on("muteMicro",(function(e){e.turnOffLocalCamera&&a.muteLocalMic(!0)})),a.setState(Object(p.a)(Object(p.a)({},a.state),{},{waitCreateRoom:!0}))},a.emitLeaveRoom=Object(h.a)(f.a.mark((function e(){var t,n,o,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.state,n=t.socket,o=t.streamId,r=t.roomOfStream,n.on("leaveRoom",{streamId:o},(function(e){if(e.leaveRoom){var t=r.filter((function(e){return e.streamId!==o}));a.setState(Object(p.a)(Object(p.a)({},a.state),{},{roomOfStream:t}))}}));case 2:case"end":return e.stop()}}),e)}))),a.turnOffLocalCamera=function(e){e?(a.state.webRTCAdaptor.turnOffLocalCamera(),a.sendNotificationEvent("CAM_TURNED_OFF")):(a.state.webRTCAdaptor.turnOnLocalCamera(),a.sendNotificationEvent("CAM_TURNED_ON"))},a.muteLocalMic=function(e){e?(a.state.webRTCAdaptor.muteLocalMic(),a.sendNotificationEvent("MIC_MUTED")):a.state.webRTCAdaptor.unmuteLocalMic()},a.sendNotificationEvent=function(e){var t=a.state,n=t.isDataChanelOpen,o=t.publishStreamId,r=t.webRTCAdaptor;if(n){var i={streamId:o,eventType:e};r.sendData(o,JSON.stringify(i))}else console.log("Could not send the notification because data channel is not open.")},a.setRedirect=function(){a.setState({redirect:!0})},a.renderRedirect=function(){if(a.state.redirect)return o.a.createElement(_.a,{to:"/"})},a.state={streamId:null,token:null,playOnly:!1,roomOfStream:new Array,publishStreamId:null,isMicMute:!1,ifCamaraOff:!1,showVideo:!1,websocketURL:"wss://videoconference.ulive.io:5443/LiveApp/websocket",adapter:null,webRTCAdaptor:null,roomNameBox:"room1",userName:"",camaraId:"",socket:null,isDataChanelOpen:!1,isAdmin:!1,waitCreateRoom:!1,redirect:!1,socketId:null},a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=Object(h.a)(f.a.mark((function e(){var t,n,a,o,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.match.params,a=t.setRoomName,o=n.roomId,r=!1,this.setState(Object(p.a)(Object(p.a)({},this.state),{},{roomNameBox:o})),a(o),e.next=7,fetch("https://webinar-zentv-front.herokuapp.com//webinar/validRoom",{method:"POST",mode:"cors",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),cache:"no-cache",body:JSON.stringify({user:"Admin",roomId:o,adminRoom:{isAdmin:!0,streamId:null}})}).then((function(e){return e.json()})).then((function(e){r=e.valid}));case 7:this.createRoom(r);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.webinarReducer;return o.a.createElement("div",{className:"w100"},o.a.createElement("div",{id:"players"},o.a.createElement("div",{className:"col"},o.a.createElement("video",{id:"localVideo",autoPlay:!0,muted:!0,width:"200",height:"200"}))),t.isAdmin?o.a.createElement(N,null):o.a.createElement(P,{camaraOff:function(){e.turnOffLocalCamera(!0)},microMute:function(){e.muteLocalMic(!0)}}),this.renderRedirect())}}]),n}(o.a.Component),D=Object(k.b)((function(e){return{webinarReducer:e.webinarReducer}}),(function(e){return{setRoomOfStream:function(t){e({type:"set_rooms",payload:t})},setRoomName:function(t){e({type:"set_room_name",payload:t})},setSocket:function(t){e({type:"set_socket",payload:t})},setAdmin:function(t){e({type:"set_admin",payload:t})}}}))(x),L=n(30),B=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).componentDidMount=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://webinar-zentv-front.herokuapp.com/webinar/createHash",{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors",cache:"default"}).then((function(e){return e.json()})).then((function(e){a.setState(Object(p.a)(Object(p.a)({},a.state),{},{roomName:e.roomsHash}))}));case 2:case"end":return e.stop()}}),e)}))),a.handleChange=function(e){var t=e.target,n=t.id,o=t.value;a.setState(Object(p.a)(Object(p.a)({},a.state),{},Object(m.a)({},"".concat(n),o)))},a.setRedirect=function(){a.setState({redirect:!0})},a.renderRedirect=function(){var e=a.props.setAdmin;if(a.state.redirect)return e(!0),o.a.createElement(_.a,{to:"/".concat(a.state.roomName)})},a.handleChangeRedirect=function(){a.createRoom()},a.createRoom=Object(h.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.roomName,e.next=3,fetch("https://webinar-zentv-front.herokuapp.com//webinar/createRoom",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({user:"Admin",roomId:t,adminRoom:{isAdmin:!0,streamId:null}})}).then((function(e){return e.json()})).then((function(e){a.setState(Object(p.a)(Object(p.a)({},a.state),{},{redirect:!0}))})).catch((function(e){console.log("Hubo un problema con la petici\xf3n Fetch:"+e.message)}));case 3:case"end":return e.stop()}}),e)}))),a.state={roomName:"room1",redirect:!1},a}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"enter-room-container"},o.a.createElement("input",{type:"text",value:this.state.roomName,id:this.state.roomName,onChange:function(t){e.handleChange(t)}}),o.a.createElement("button",{onClick:function(){e.handleChangeRedirect()}},"Enter"),this.renderRedirect())}}]),n}(o.a.Component),V=Object(k.b)(null,(function(e){return{setAdmin:function(t){e({type:"set_admin",payload:t})}}}))(B),z=n(22),J={streamId:null,token:null,playOnly:!1,roomOfStream:new Array,publishStreamId:null,isMicMute:!1,ifCamaraOff:!1,showVideo:!1,websocketURL:"wss://videoconference.ulive.io:5443/LiveApp/websocket",adapter:null,webRTCAdaptor:null,roomNameBox:"room1",userName:"",camaraId:"",socket:null,isDataChanelOpen:!1,isAdmin:!1,socketId:null},H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"camara_off":return Object(p.a)(Object(p.a)({},e),{},{ifCamaraOff:t.payload});case"micro_mute":return Object(p.a)(Object(p.a)({},e),{},{isMicMute:t.payload});case"leave_room":return Object(p.a)(Object(p.a)({},e),{},{roomNameBox:t.payload});case"admin_room":return Object(p.a)(Object(p.a)({},e),{},{isAdmin:t.payload});case"add_member_room":case"set_rooms":return Object(p.a)(Object(p.a)({},e),{},{roomOfStream:t.payload});case"set_room_name":return Object(p.a)(Object(p.a)({},e),{},{roomNameBox:t.payload});case"set_socket":return Object(p.a)(Object(p.a)({},e),{},{socket:t.payload});case"set_admin":return Object(p.a)(Object(p.a)({},e),{},{isAdmin:t.payload});case"set_sockets_id":return Object(p.a)(Object(p.a)({},e),{},{socketId:t.payload});default:return e}},U=Object(z.b)({webinarReducer:H}),W=Object(z.c)(U),G=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return o.a.createElement(k.a,{store:W},o.a.createElement(L.a,null,o.a.createElement(o.a.Fragment,null,o.a.createElement(_.b,{path:"/",exact:!0,component:V}),o.a.createElement(_.b,{path:"/:roomId",exact:!0,component:D}))))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(G,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},75:function(e,t,n){e.exports=n(131)},80:function(e,t,n){}},[[75,1,2]]]);
//# sourceMappingURL=main.c02f5bd5.chunk.js.map